<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ME 507 Soft Keyboard: PlatformSoftKeyboardControl/src/main.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ME 507 Soft Keyboard<span id="projectnumber">&#160;2.0.0</span>
   </div>
   <div id="projectbrief">Uses a piezoresistive metamaterial to control a 2DOF table</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('main_8cpp.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">main.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>This project was created to run the soft-sensor activated balancing platform as the final project of Cal Poly SLO Fall ME 507 class.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;Arduino.h&gt;</code><br />
<code>#include &lt;ESP32Encoder.h&gt;</code><br />
<code>#include &lt;Wire.h&gt;</code><br />
<code>#include &lt;Adafruit_Sensor.h&gt;</code><br />
<code>#include &lt;Adafruit_BNO055.h&gt;</code><br />
<code>#include &lt;cmath&gt;</code><br />
<code>#include &lt;WebServer.h&gt;</code><br />
<code>#include &quot;ADC128D818.h&quot;</code><br />
<code>#include &quot;PCA9956.h&quot;</code><br />
<code>#include &quot;PrintStream.h&quot;</code><br />
<code>#include &quot;IMU.h&quot;</code><br />
<code>#include &quot;MOTOR.h&quot;</code><br />
<code>#include &quot;ENCODER.h&quot;</code><br />
<code>#include &quot;<a class="el" href="_e_i_twebhost_8h_source.html">EITwebhost.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_c_d74_h_c4067_s_m_8h_source.html">CD74HC4067SM.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="shares_8h_source.html">shares.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:acb8d9e1ab8f1d0bc2abfa0eab6a7e706" id="r_acb8d9e1ab8f1d0bc2abfa0eab6a7e706"><td class="memItemLeft" align="right" valign="top"><a id="acb8d9e1ab8f1d0bc2abfa0eab6a7e706" name="acb8d9e1ab8f1d0bc2abfa0eab6a7e706"></a>
Share&lt; bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>initializeVFLG</b> (&quot;Measure V0&quot;)</td></tr>
<tr class="memitem:adb3985c4e0dc89bde6f73ad5152e78e4" id="r_adb3985c4e0dc89bde6f73ad5152e78e4"><td class="memItemLeft" align="right" valign="top"><a id="adb3985c4e0dc89bde6f73ad5152e78e4" name="adb3985c4e0dc89bde6f73ad5152e78e4"></a>
Share&lt; bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>readVFLG</b> (&quot;Read V&quot;)</td></tr>
<tr class="memitem:a04161a0333e46749f1310cdaf6c4ff1c" id="r_a04161a0333e46749f1310cdaf6c4ff1c"><td class="memItemLeft" align="right" valign="top"><a id="a04161a0333e46749f1310cdaf6c4ff1c" name="a04161a0333e46749f1310cdaf6c4ff1c"></a>
Share&lt; float &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>xBar</b> (&quot;X Centroid&quot;)</td></tr>
<tr class="memitem:ac737158b9185276c9ce848c453128b84" id="r_ac737158b9185276c9ce848c453128b84"><td class="memItemLeft" align="right" valign="top"><a id="ac737158b9185276c9ce848c453128b84" name="ac737158b9185276c9ce848c453128b84"></a>
Share&lt; float &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>yBar</b> (&quot;Y Centroid&quot;)</td></tr>
<tr class="memitem:a6e84d191593b8e526ada135e8e26edf5" id="r_a6e84d191593b8e526ada135e8e26edf5"><td class="memItemLeft" align="right" valign="top"><a id="a6e84d191593b8e526ada135e8e26edf5" name="a6e84d191593b8e526ada135e8e26edf5"></a>
Share&lt; bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>dataAvailable</b> (&quot;Publish Flag&quot;)</td></tr>
<tr class="memitem:af65c7f4495d4dc7c29d355d2d3871be4" id="r_af65c7f4495d4dc7c29d355d2d3871be4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af65c7f4495d4dc7c29d355d2d3871be4">task_ReadMaterial</a> (void *p_params)</td></tr>
<tr class="memdesc:af65c7f4495d4dc7c29d355d2d3871be4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Task to handle cycling through the pins to take EIT voltage readings.  <br /></td></tr>
<tr class="memitem:a0600249a0fd5d92a5fed83010c329fe3" id="r_a0600249a0fd5d92a5fed83010c329fe3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0600249a0fd5d92a5fed83010c329fe3">task_controlMotors</a> (void *parameter)</td></tr>
<tr class="memdesc:a0600249a0fd5d92a5fed83010c329fe3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Task to handle controlling the table position using an IMU and two motors.  <br /></td></tr>
<tr class="memitem:a577f28c6d870b5b9f1c4510d8195094a" id="r_a577f28c6d870b5b9f1c4510d8195094a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a577f28c6d870b5b9f1c4510d8195094a">task_webserver</a> (void *p_params)</td></tr>
<tr class="memdesc:a577f28c6d870b5b9f1c4510d8195094a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Task to handle the webpage for user interfacing.  <br /></td></tr>
<tr class="memitem:a4fc01d736fe50cf5b977f755b675f11d" id="r_a4fc01d736fe50cf5b977f755b675f11d"><td class="memItemLeft" align="right" valign="top"><a id="a4fc01d736fe50cf5b977f755b675f11d" name="a4fc01d736fe50cf5b977f755b675f11d"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>setup</b> ()</td></tr>
<tr class="memitem:afe461d27b9c48d5921c00d521181f12f" id="r_afe461d27b9c48d5921c00d521181f12f"><td class="memItemLeft" align="right" valign="top"><a id="afe461d27b9c48d5921c00d521181f12f" name="afe461d27b9c48d5921c00d521181f12f"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>loop</b> ()</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-var-members" class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a9e384041fab2b2e8797505c609b8d99c" id="r_a9e384041fab2b2e8797505c609b8d99c"><td class="memItemLeft" align="right" valign="top"><a id="a9e384041fab2b2e8797505c609b8d99c" name="a9e384041fab2b2e8797505c609b8d99c"></a>
const uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>s0_PIN</b> = 26</td></tr>
<tr class="memitem:aee5c3166ce3fa80f79805587f049c8c4" id="r_aee5c3166ce3fa80f79805587f049c8c4"><td class="memItemLeft" align="right" valign="top"><a id="aee5c3166ce3fa80f79805587f049c8c4" name="aee5c3166ce3fa80f79805587f049c8c4"></a>
const uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>s1_PIN</b> = 25</td></tr>
<tr class="memitem:a02c801e8ca7815dec62bf55ca86512bc" id="r_a02c801e8ca7815dec62bf55ca86512bc"><td class="memItemLeft" align="right" valign="top"><a id="a02c801e8ca7815dec62bf55ca86512bc" name="a02c801e8ca7815dec62bf55ca86512bc"></a>
const uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>s2_PIN</b> = 33</td></tr>
<tr class="memitem:a33f0388f0631792d35e717cc687e6051" id="r_a33f0388f0631792d35e717cc687e6051"><td class="memItemLeft" align="right" valign="top"><a id="a33f0388f0631792d35e717cc687e6051" name="a33f0388f0631792d35e717cc687e6051"></a>
const uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>s3_PIN</b> = 32</td></tr>
<tr class="memitem:a3323d05cd41da7f205db662a3e8c0f59" id="r_a3323d05cd41da7f205db662a3e8c0f59"><td class="memItemLeft" align="right" valign="top"><a id="a3323d05cd41da7f205db662a3e8c0f59" name="a3323d05cd41da7f205db662a3e8c0f59"></a>
const uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>MultiEnable_PIN</b> = 35</td></tr>
<tr class="memitem:a9eb336ce22cd3b5df6e7b5c7df0460a3" id="r_a9eb336ce22cd3b5df6e7b5c7df0460a3"><td class="memItemLeft" align="right" valign="top"><a id="a9eb336ce22cd3b5df6e7b5c7df0460a3" name="a9eb336ce22cd3b5df6e7b5c7df0460a3"></a>
const uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>ADC_1ADDRESS</b> = 0x1D</td></tr>
<tr class="memitem:a41a404f2f5b85d9ddfc16560b818ec46" id="r_a41a404f2f5b85d9ddfc16560b818ec46"><td class="memItemLeft" align="right" valign="top"><a id="a41a404f2f5b85d9ddfc16560b818ec46" name="a41a404f2f5b85d9ddfc16560b818ec46"></a>
const uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>ADC_2ADDRESS</b> = 0x1F</td></tr>
<tr class="memitem:a24dd1f95a4290b15c52e8bc664bc7902" id="r_a24dd1f95a4290b15c52e8bc664bc7902"><td class="memItemLeft" align="right" valign="top"><a id="a24dd1f95a4290b15c52e8bc664bc7902" name="a24dd1f95a4290b15c52e8bc664bc7902"></a>
const uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>PCA9956_ADDRESS</b> = 0x01</td></tr>
<tr class="memitem:af7a1a90c51a823bdd750d7dfd4418853" id="r_af7a1a90c51a823bdd750d7dfd4418853"><td class="memItemLeft" align="right" valign="top"><a id="af7a1a90c51a823bdd750d7dfd4418853" name="af7a1a90c51a823bdd750d7dfd4418853"></a>
PCA9956 CurrCtrl &amp;&#160;</td><td class="memItemRight" valign="bottom"><b>Wire</b></td></tr>
<tr class="memitem:ae127ca0dd941de03bd8996e475e56b6c" id="r_ae127ca0dd941de03bd8996e475e56b6c"><td class="memItemLeft" align="right" valign="top"><a id="ae127ca0dd941de03bd8996e475e56b6c" name="ae127ca0dd941de03bd8996e475e56b6c"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>nSleepPin</b> = 02</td></tr>
<tr class="memitem:ae6c23a418fe55e82bd865a8e28b288b6" id="r_ae6c23a418fe55e82bd865a8e28b288b6"><td class="memItemLeft" align="right" valign="top"><a id="ae6c23a418fe55e82bd865a8e28b288b6" name="ae6c23a418fe55e82bd865a8e28b288b6"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>motorXPin1</b> = 19</td></tr>
<tr class="memitem:a503e5959872082ff62252a26bdf3fe99" id="r_a503e5959872082ff62252a26bdf3fe99"><td class="memItemLeft" align="right" valign="top"><a id="a503e5959872082ff62252a26bdf3fe99" name="a503e5959872082ff62252a26bdf3fe99"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>motorXPin2</b> = 18</td></tr>
<tr class="memitem:ab77cd3b2d61bdea0601f5350abcf71d5" id="r_ab77cd3b2d61bdea0601f5350abcf71d5"><td class="memItemLeft" align="right" valign="top"><a id="ab77cd3b2d61bdea0601f5350abcf71d5" name="ab77cd3b2d61bdea0601f5350abcf71d5"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>motorYPin1</b> = 17</td></tr>
<tr class="memitem:a8f51ad3c525971da3feea5c823acf32e" id="r_a8f51ad3c525971da3feea5c823acf32e"><td class="memItemLeft" align="right" valign="top"><a id="a8f51ad3c525971da3feea5c823acf32e" name="a8f51ad3c525971da3feea5c823acf32e"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>motorYPin2</b> = 16</td></tr>
<tr class="memitem:a725fa6b340030a320096ff043a24a283" id="r_a725fa6b340030a320096ff043a24a283"><td class="memItemLeft" align="right" valign="top"><a id="a725fa6b340030a320096ff043a24a283" name="a725fa6b340030a320096ff043a24a283"></a>
ESP32Encoder&#160;</td><td class="memItemRight" valign="bottom"><b>encoderX</b></td></tr>
<tr class="memitem:ad2f255b53647f679fe6141a5914fa40c" id="r_ad2f255b53647f679fe6141a5914fa40c"><td class="memItemLeft" align="right" valign="top"><a id="ad2f255b53647f679fe6141a5914fa40c" name="ad2f255b53647f679fe6141a5914fa40c"></a>
ESP32Encoder&#160;</td><td class="memItemRight" valign="bottom"><b>encoderY</b></td></tr>
<tr class="memitem:ae77c28be56bf5e9e5aa6b8ff1a554b20" id="r_ae77c28be56bf5e9e5aa6b8ff1a554b20"><td class="memItemLeft" align="right" valign="top"><a id="ae77c28be56bf5e9e5aa6b8ff1a554b20" name="ae77c28be56bf5e9e5aa6b8ff1a554b20"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>publish</b> [208] = {0}</td></tr>
<tr class="memitem:a9610be4c840b076d78500f00dcc02f21" id="r_a9610be4c840b076d78500f00dcc02f21"><td class="memItemLeft" align="right" valign="top"><a id="a9610be4c840b076d78500f00dcc02f21" name="a9610be4c840b076d78500f00dcc02f21"></a>
SemaphoreHandle_t&#160;</td><td class="memItemRight" valign="bottom"><b>twiMutex</b></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This project was created to run the soft-sensor activated balancing platform as the final project of Cal Poly SLO Fall ME 507 class. </p>
<dl class="section author"><dt>Author</dt><dd>Setting-Dawn </dd>
<dd>
Jake Rowen </dd>
<dd>
Ethan Siahpush </dd></dl>
<dl class="section version"><dt>Version</dt><dd>2.0.0 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2025-Dec-09 </dd></dl>
</div><a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="a0600249a0fd5d92a5fed83010c329fe3" name="a0600249a0fd5d92a5fed83010c329fe3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0600249a0fd5d92a5fed83010c329fe3">&#9670;&#160;</a></span>task_controlMotors()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void task_controlMotors </td>
          <td>(</td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>parameter</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Task to handle controlling the table position using an IMU and two motors. </p>
<p>Has PID control on both motors to attempt to reach the desired setpoint and measured by a BNO055A IMU. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_params</td><td>void*, unused. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af65c7f4495d4dc7c29d355d2d3871be4" name="af65c7f4495d4dc7c29d355d2d3871be4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af65c7f4495d4dc7c29d355d2d3871be4">&#9670;&#160;</a></span>task_ReadMaterial()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void task_ReadMaterial </td>
          <td>(</td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>p_params</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Task to handle cycling through the pins to take EIT voltage readings. </p>
<p>First waits for initialization of twi communication to complete. Then each round has one channel with an applied current, one grounded, and 14 others. ADCs read all adc channels, discards the two non-read channels, finds the deltaV between appropriate pins and stores all values in the resulting array into a global array after lowering the dataAvailable flag. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_params</td><td>void*, unused. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a577f28c6d870b5b9f1c4510d8195094a" name="a577f28c6d870b5b9f1c4510d8195094a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a577f28c6d870b5b9f1c4510d8195094a">&#9670;&#160;</a></span>task_webserver()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void task_webserver </td>
          <td>(</td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>p_params</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Task to handle the webpage for user interfacing. </p>
<p>publishes all 208 datapoints used for 1 measurement and some flags used by an external python program to know whether to initialize a base value or make appropriate calculations. Additionally, uses args on the webpage to allow the user or external python program to set a desired table position. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_params</td><td>void*, unused. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_d13532948e496c057305109c9170e06c.html">PlatformSoftKeyboardControl</a></li><li class="navelem"><b>src</b></li><li class="navelem"><a href="main_8cpp.html">main.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
